<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <title>Ø¨Ø§Ø²ÛŒ Ø¨Ø¯Ø´Ú©Ù† Ø·Ø§ÙˆÛŒØªØ§</title>

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- ÙÙˆÙ†Øª ÙØ§Ø±Ø³ÛŒ -->
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    html, body{
      height:100%;
    }
    
    *{
      margin:0;
      padding:0;
      box-sizing:border-box;
      font-family:'Vazirmatn',sans-serif;
    }

    /* âœ… Ø¨Ø¯Ù†Ù‡: Ø¨Ø¯ÙˆÙ† Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¹Ù…ÙˆØ¯ÛŒØŒ ØªÙ…Ø§Ù… Ø§Ø±ØªÙØ§Ø¹ ØµÙØ­Ù‡ */
    body{
      background:#111533;
      color:#fff;
      display:flex;
      flex-direction:column;
      height:100vh;
      min-height:100vh;
      overflow-x:hidden;
      overflow-y:hidden;
      transition:background .2s ease,color .2s ease;
    }

    /* ØªÙ… Ø±ÙˆØ´Ù† */
    body.light-mode{
      background:#f4f4fb;
      color:#111827;
    }
    body.light-mode canvas{
      background:#ffffff;
      box-shadow:0 0 18px rgba(15,23,42,.25);
    }
    body.light-mode #hint{
      background:#e5e7eb;
      color:#111827;
      border-color:#d1d5db;
    }
    body.light-mode #dailyInner{
      background:#e5e7eb;
      border-color:#d1d5db;
    }
    body.light-mode #progressBarOuter{
      background:#e5e7eb;
    }
    body.light-mode #bottom-bar{
      background:rgba(255,255,255,.9);
      color:#111827;
    }
    body.light-mode .box{
      background:#ffffff;
      color:#111827;
    }
    body.light-mode .shopItem{
      background:#e5e7ff;
      color:#111827;
    }
    body.light-mode .shopItem span{
      color:#111827;
    }
    body.light-mode .shopItem button{
      background:#f97316;
      color:#111827;
    }

    /* Ù‡Ø¯Ø± Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡: Ù„ÙˆÚ¯Ùˆ + Ø¹Ù†ÙˆØ§Ù† + Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
    #header-bar{
      width:100%;
      padding:6px 10px 4px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      direction:ltr;
      gap:10px;
    }

    #header-left{
      display:flex;
      gap:8px;
      direction:rtl;
    }

    #header-right{
      display:flex;
      align-items:center;
      gap:8px;
      direction:rtl;
    }

    #gameLogo{
      width:36px;
      height:36px;
      border-radius:999px;
      object-fit:cover;
    }

    #gameTitle{
      font-size:18px;
      font-weight:700;
    }

    #top-bar{
      width:100%;
      padding:4px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      direction:ltr;
      font-size:14px;
      gap:8px;
    }
    #top-left{
      display:flex;
      gap:10px;
      align-items:center;
      direction:rtl;
      font-size:13px;
    }
    #top-right{
      display:flex;
      gap:4px;
      align-items:center;
    }
    .iconBtn{
      border:none;
      padding:2px 6px;
      border-radius:999px;
      background:#2c2e7a;
      color:#fff;
      font-size:14px;
      box-shadow:0 0 6px rgba(0,0,0,.4);
      cursor:pointer;
      white-space:nowrap;
      display:flex;
      align-items:center;
      justify-content:center;
      min-width:26px;
      min-height:26px;
    }
    .iconBtn:active{transform:scale(.97)}
    body.light-mode .iconBtn{
      background:#e5e7eb;
      color:#111827;
      box-shadow:0 0 4px rgba(148,163,184,.6);
    }

    /* Ù†ÙˆØ§Ø± Ù¾ÛŒØ´Ø±ÙØª */
    #progressWrap{
      width:100%;
      padding:0 10px 4px;
    }
    #progressBarOuter{
      width:100%;
      height:6px;
      border-radius:999px;
      background:#22244a;
      overflow:hidden;
      box-shadow:0 0 6px rgba(0,0,0,0.6);
    }
    #progressBarInner{
      width:0%;
      height:100%;
      background:linear-gradient(90deg,#22c55e,#a3e635);
      transition:width .2s ease-out;
    }

    /* Ù†ÙˆØ§Ø± Ù¾ÛŒØ§Ù… */
    #hint-bar{
      width:100%;
      padding:4px 10px 4px;
      font-size:12px;
      direction:rtl;
      color:#e5e7eb;
      opacity:.95;
    }
    #hint{
      width:100%;
      text-align:right;
      background:#1f2937;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid #374151;
      box-shadow:0 0 8px rgba(0,0,0,.35);
    }

    /* âœ… Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø¨Ø§Ø²ÛŒ: Ø§Ø±ØªÙØ§Ø¹ Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ ØµÙØ­Ù‡ */
    #game-container{
      width:100%;
      flex-grow:1;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:8px 0 16px;
      height:calc(100vh - 140px);    /* Ù‡Ø¯Ø± + Ù†ÙˆØ§Ø± ÙˆØ¶Ø¹ÛŒØª + Ù†ÙˆØ§Ø± Ù¾ÛŒØ´Ø±ÙØª + Ù¾ÛŒØ§Ù… + Ù†ÙˆØ§Ø± Ù¾Ø§ÛŒÛŒÙ† */
      max-height:calc(100vh - 140px);
    }

    canvas{
      background:#141947;
      border-radius:14px;
      box-shadow:0 0 18px rgba(0,0,0,.7);
      touch-action:none;
    }

    /* Ù†ÙˆØ§Ø± Ù¾Ø§ÛŒÛŒÙ†: Ø´Ø§Ù¾ + Ø¯Ø±Ø¨Ø§Ø±Ù‡ + ØªÙ…Ø±ÛŒÙ† Ø±ÙˆØ²Ø§Ù†Ù‡ */
    #bottom-bar{
      width:100%;
      padding:6px 10px 10px;
      font-size:12px;
      direction:rtl;
      opacity:.9;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
      background:rgba(0,0,0,.12);
    }

    #bottom-left{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      justify-content:flex-start;
    }

    #bottom-right{
      margin-right:auto;
      display:flex;
      justify-content:flex-end;
      min-width:180px;
    }

    .btn{
      border:none;
      padding:6px 12px;
      border-radius:999px;
      background:#1abc9c;
      color:#fff;
      font-size:12px;
      cursor:pointer;
      box-shadow:0 0 8px rgba(0,0,0,.5);
      white-space:nowrap;
    }
    .btn-shop{background:#ff8c00;}
    .btn:active{transform:scale(.97)}
    body.light-mode .btn{
      box-shadow:0 0 5px rgba(148,163,184,.6);
    }

    /* ØªÙ…Ø±ÛŒÙ† Ø±ÙˆØ²Ø§Ù†Ù‡ Ù¾Ø§ÛŒÛŒÙ† Ø³Ù…Øª Ø±Ø§Ø³Øª */
    #dailyInner{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      background:#161b3c;
      border-radius:999px;
      padding:4px 10px;
      border:1px solid #272a5e;
      cursor:pointer;
      min-width:190px;
    }
    #dailyLabel{
      white-space:nowrap;
      opacity:.9;
      font-size:11px;
    }
    #dailyDots{
      display:flex;
      gap:4px;
    }
    .dailyDot{
      width:10px;
      height:10px;
      border-radius:999px;
      border:1px solid #4b5563;
      background:transparent;
      box-shadow:none;
      transition:all .2s ease-out;
    }
    .dailyDot.filled{
      background:radial-gradient(circle at 30% 30%,#facc15,#f97316);
      border-color:#facc15;
      box-shadow:0 0 8px rgba(250,204,21,.8);
    }

    .overlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.7);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:10;
    }
    .box{
      background:#1b144f;
      padding:16px;
      border-radius:16px;
      width:90%;
      max-width:380px;
      box-shadow:0 0 18px rgba(0,0,0,.8);
      direction:rtl;
      text-align:right;
      font-size:13px;
      line-height:1.7;
      position:relative;
      color:#f9fafb;
    }
    .box h3{
      margin-bottom:8px;
      font-size:16px;
    }
    .box p{margin:4px 0;}
    .closeBtn{
      margin-top:10px;
      width:100%;
      border:none;
      padding:7px 14px;
      border-radius:999px;
      background:#4444aa;
      color:#fff;
      font-size:13px;
      cursor:pointer;
      box-shadow:0 0 8px rgba(0,0,0,.5);
    }
    .closeBtn:active{transform:scale(.97)}

    .shopItem{
      background:#24145f;
      padding:8px;
      border-radius:10px;
      margin:6px 0;
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:13px;
      transition:transform .15s ease,box-shadow .15s ease;
    }
    .shopItem span{display:block}
    .shopItem button{
      padding:4px 10px;
      font-size:11px;
      border:none;
      border-radius:999px;
      background:#ff8c00;
      color:#fff;
      cursor:pointer;
    }
    .shopItem.bought{
      transform:scale(1.03);
      box-shadow:0 0 14px rgba(46,204,113,.8);
    }
    #shopMessage{
      position:absolute;
      top:4px;
      left:12px;
      font-size:11px;
      color:#2ecc71;
      opacity:0;
      pointer-events:none;
    }
    .shopMessageVisible{
      animation:shopFlash 1s ease-out forwards;
    }
    @keyframes shopFlash{
      0%{opacity:0;transform:translateY(-4px);}
      20%{opacity:1;transform:translateY(0);}
      80%{opacity:1;}
      100%{opacity:0;transform:translateY(-6px);}
    }

    #gameOverBox p{margin:4px 0;}

    /* Ø§ÙÚ©Øª +Û² Ø¬ÙˆÙ† */
    .lifeGain{
      position:fixed;
      top:6px;
      left:50%;
      transform:translateX(-50%);
      font-size:14px;
      color:#f97316;
      text-shadow:0 0 6px rgba(0,0,0,.7);
      animation:lifeFloat 1s ease-out forwards;
      z-index:20;
      pointer-events:none;
    }
    @keyframes lifeFloat{
      0%{opacity:0;transform:translate(-50%,0);}
      30%{opacity:1;transform:translate(-50%,-6px);}
      100%{opacity:0;transform:translate(-50%,-22px);}
    }

    /* Ù¾Ø±ÙˆÙØ§ÛŒÙ„ */
    #profileStats{
      font-size:13px;
      margin-top:6px;
      line-height:1.8;
    }
  </style>
</head>
<body>
  <!-- Ù‡Ø¯Ø±: Ù„ÙˆÚ¯Ùˆ + Ø¹Ù†ÙˆØ§Ù† + Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ø§Ù¾/Ø¯Ø±Ø¨Ø§Ø±Ù‡ -->
  <div id="header-bar">
    <div id="header-left">
      <button id="aboutBtn" class="btn">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</button>
      <button id="shopBtn" class="btn btn-shop">Ø´Ø§Ù¾</button>
    </div>

    <div id="header-right">
      <img
        id="gameLogo"
        src="https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-14-07-34-00-477.webp"
        alt="Ù„ÙˆÚ¯ÙˆÛŒ Ø·Ø§ÙˆÛŒØªØ§"
      />
      <span id="gameTitle">Ø¨Ø§Ø²ÛŒ Ø¨Ø¯Ø´Ú©Ù† Ø·Ø§ÙˆÛŒØªØ§</span>
    </div>
  </div>

  <!-- Ù†ÙˆØ§Ø± ÙˆØ¶Ø¹ÛŒØª: Ø¬Ø§Ù† / Ø§Ù…ØªÛŒØ§Ø² / Ù…Ø±Ø­Ù„Ù‡ + Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ -->
  <div id="top-bar">
    <div id="top-left">
      <div>â¤ï¸ <span id="livesEl">3</span></div>
      <div>Ø§Ù…ØªÛŒØ§Ø²: <span id="scoreEl">0</span></div>
      <div>Ù…Ø±Ø­Ù„Ù‡: <span id="levelEl">1</span></div>
    </div>

    <div id="top-right">
      <button id="pauseBtn" class="iconBtn" title="Ø´Ø±ÙˆØ¹ / ØªÙˆÙ‚Ù">â¸</button>
      <button id="soundBtn" class="iconBtn" title="ØµØ¯Ø§">ğŸ”Š</button>
      <button id="themeBtn" class="iconBtn" title="Ø±ÙˆØ² / Ø´Ø¨">ğŸŒ™</button>
      <button id="helpBtn" class="iconBtn" title="Ø±Ø§Ù‡Ù†Ù…Ø§">â“</button>
      <button id="calmBtn" class="iconBtn" title="Ù„Ø­Ø¸Ù‡ Ø¢Ø±Ø§Ù…Ø´">ğŸ§˜</button>
      <button id="profileBtn" class="iconBtn" title="Ù¾Ø±ÙˆÙØ§ÛŒÙ„">ğŸ‘¤</button>
    </div>
  </div>

  <!-- Ù†ÙˆØ§Ø± Ù¾ÛŒØ´Ø±ÙØª -->
  <div id="progressWrap">
    <div id="progressBarOuter">
      <div id="progressBarInner"></div>
    </div>
  </div>

  <!-- Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ -->
  <div id="hint-bar">
    <div id="hint">Ø¨Ø§ Ø§Ù†Ú¯Ø´Øª Ù¾ÙØ¯ Ø±Ø§ Ø­Ø±Ú©Øª Ø¨Ø¯Ù‡ Ùˆ Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø¯ Ø±Ø§ Ø¨Ø´Ú©Ù† ğŸ’«</div>
  </div>

  <div id="game-container">
    <canvas id="game"></canvas>
  </div>

  <!-- Ù†ÙˆØ§Ø± Ù¾Ø§ÛŒÛŒÙ† -->
  <div id="bottom-bar">
    <div id="bottom-left"></div>
    <div id="bottom-right">
      <div id="dailyInner">
        <span id="dailyLabel">ØªÙ…Ø±ÛŒÙ† Ø±ÙˆØ²Ø§Ù†Ù‡ Ø§Ù…Ø±ÙˆØ²</span>
        <div id="dailyDots">
          <div class="dailyDot"></div>
          <div class="dailyDot"></div>
          <div class="dailyDot"></div>
          <div class="dailyDot"></div>
          <div class="dailyDot"></div>
          <div class="dailyDot"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø± -->
  <div id="nameOverlay" class="overlay">
    <div class="box">
      <h3>Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒ Ø¨Ù‡ Ø¨Ø§Ø²ÛŒ Ø¨Ø¯Ø´Ú©Ù† Ø·Ø§ÙˆÛŒØªØ§ ğŸ’œ</h3>
      <p>Ø§Ø³Ù…Øª Ø±Ùˆ Ø¨Ù†ÙˆÛŒØ³ ØªØ§ Ø¯Ø± Ø·ÙˆÙ„ Ø¨Ø§Ø²ÛŒ Ø¨Ø§ Ù‡Ù…ÙˆÙ† ØµØ¯Ø§Øª Ú©Ù†Ù…:</p>
      <input
        id="nameInput"
        type="text"
        maxlength="20"
        placeholder="Ù…Ø«Ù„Ø§Ù‹ Ø§Ù„Ù‡Ù‡"
        style="margin-top:8px;width:100%;padding:6px 10px;border-radius:10px;border:1px solid #4b5563;background:#020617;color:#f9fafb;"
      />
      <button id="saveNameBtn" class="closeBtn" style="margin-top:10px;">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ âœ…</button>
    </div>
  </div>

  <!-- Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¨Ø§Ø²ÛŒ -->
  <div id="helpOverlay" class="overlay">
    <div class="box">
      <h3>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø¨Ø¯Ø´Ú©Ù† Ø·Ø§ÙˆÛŒØªØ§ ğŸ®</h3>
      <p>â—€ Ø¨Ø§ Ø§Ù†Ú¯Ø´Øª ÛŒØ§ Ù…Ø§ÙˆØ³ØŒ Ù¾ÙØ¯ Ù¾Ø§ÛŒÛŒÙ† ØµÙØ­Ù‡ Ø±Ø§ Ø­Ø±Ú©Øª Ø¨Ø¯Ù‡ ØªØ§ ØªÙˆÙ¾ Ø¨Ù‡ Ø¢Ø¬Ø±Ù‡Ø§ Ø¨Ø±Ø®ÙˆØ±Ø¯ Ú©Ù†Ø¯ Ùˆ Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø¯ (ØªÙ†Ø¨Ù„ÛŒØŒ Ø®Ø´Ù…ØŒ Ù†Ø§Ø§Ù…ÛŒØ¯ÛŒ Ùˆ...) Ø±Ø§ ÛŒÚ©ÛŒâ€ŒÛŒÚ©ÛŒ Ø¨Ø´Ú©Ù†ÛŒ.</p>
      <p>â—€ Ù‡Ø± Ø¢Ø¬Ø± ÛŒÚ© Ø¹Ø§Ø¯Øª Ù…Ù†ÙÛŒ Ø§Ø³ØªØ› ÙˆÙ‚ØªÛŒ Ù…ÛŒâ€ŒØ´Ú©Ù†Ø¯ØŒ ÛŒÚ© Ø¬Ù…Ù„Ù‡â€ŒÛŒ Ù…Ø«Ø¨Øª Ùˆ ØªÙ‚ÙˆÛŒØªâ€ŒÚ©Ù†Ù†Ø¯Ù‡ Ø¨Ø§Ù„Ø§ Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ ØªØ§ Ø¢Ø±Ø§Ù…â€ŒØ¢Ø±Ø§Ù… Ø°Ù‡Ù†â€ŒØ§Øª Ù‡Ù… Ù‡Ù…Ø±Ø§Ù‡ Ø¨Ø§Ø²ÛŒ ØªØºÛŒÛŒØ± Ú©Ù†Ø¯ ğŸŒ±</p>
      <p>â—€ Ù‡Ø± Ù…Ø±Ø­Ù„Ù‡ Ú©Ù‡ Ú©Ø§Ù…Ù„ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØŒ <b>Û² ØªØ§ Ø¬ÙˆÙ† Ø¬Ø¯ÛŒØ¯</b> Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒ â¤ï¸ Ùˆ Ú©Ù…â€ŒÚ©Ù… Ù†ÙˆØ§Ø± Ù¾ÛŒØ´Ø±ÙØª Ø¨Ø§Ù„Ø§ Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯Ø› ÛŒØ¹Ù†ÛŒ Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø¨ÛŒØ´ØªØ±ÛŒ Ø±Ø§ Ø´Ú©Ø³ØªÛŒ.</p>
      <p>â—€ Ø¯Ø§ÛŒØ±Ù‡â€ŒÙ‡Ø§ÛŒ Ø±Ù†Ú¯ÛŒ Ú©Ù‡ Ø§Ø² Ø¢Ø¬Ø±Ù‡Ø§ Ù…ÛŒâ€ŒØ§ÙØªØ¯ Ù¾Ø§ÙˆØ±Ø¢Ù¾ Ù‡Ø³ØªÙ†Ø¯Ø› Ø¢Ù†â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ú¯ÛŒØ± ØªØ§: Ù¾Ø¯ Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ø´ÙˆØ¯ØŒ ØªÙˆÙ¾ Ù‚ÙˆÛŒâ€ŒØªØ± Ø´ÙˆØ¯ØŒ ØªÙˆÙ¾ Ø¢Ù‡Ø³ØªÙ‡â€ŒØªØ± Ø­Ø±Ú©Øª Ú©Ù†Ø¯ ÛŒØ§ Ø­Ø§Ù„Øª Ú†Ù†Ø¯ØªÙˆÙ¾ÛŒ ÙØ¹Ø§Ù„ Ø´ÙˆØ¯ ğŸ˜</p>
      <p>â—€ Ø­ÙˆØ§Ø³Øª Ø¨Ù‡ ØªÙˆÙ¾â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ§Ù‡ Ù‡Ù… Ø¨Ø§Ø´Ø¯! Ø§Ú¯Ø± ÛŒÚ© ØªÙˆÙ¾ Ø³ÛŒØ§Ù‡ Ø¨Ú¯ÛŒØ±ÛŒØŒ Ù¾Ø¯Øª Ú©Ù…ÛŒ Ú©ÙˆÚ†Ú©ØªØ± Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ú©Ù†ØªØ±Ù„ Ø³Ø®Øªâ€ŒØªØ± Ù…ÛŒâ€ŒØ´ÙˆØ¯ âš«</p>
      <p>â—€ Ø¯Ø± Â«Ø´Ø§Ù¾Â» Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒ Ø¨Ø§ Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¬Ù…Ø¹ Ú©Ø±Ø¯ÛŒØŒ Ø±ÙØªØ§Ø±Ù‡Ø§ÛŒ Ø®ÙˆØ¨ (Ù¾Ø§ÙˆØ±Ø¢Ù¾â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø¦Ù…â€ŒØªØ±) Ø¨Ø®Ø±ÛŒ Ùˆ Ø¨Ø§Ø²ÛŒ Ø±Ø§ Ø±Ø§Ø­Øªâ€ŒØªØ± Ú©Ù†ÛŒ.</p>
      <button class="closeBtn" id="closeHelp">ÙÙ‡Ù…ÛŒØ¯Ù…ØŒ Ø¨Ø²Ù† Ø¨Ø±ÛŒÙ… ğŸ’ª</button>
    </div>
  </div>

  <!-- Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§ -->
  <div id="aboutOverlay" class="overlay">
    <div class="box">
      <h3>Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø·Ø§ÙˆÛŒØªØ§ ğŸŒ¸</h3>
      <p>Ø¨Ø§Ø²ÛŒ <b>Ø¨Ø¯Ø´Ú©Ù† Ø·Ø§ÙˆÛŒØªØ§</b> Ø·ÙˆØ±ÛŒ Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ú©Ù‡ ØªÙ…Ø±ÛŒÙ† ØªØ±Ú© Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø¯ Ùˆ ØªÙ‚ÙˆÛŒØª Ø°Ù‡Ù† Ù…Ø«Ø¨Øª Ø±Ø§ ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ ÛŒÚ© Ø¨Ø§Ø²ÛŒ Ø³Ø§Ø¯Ù‡ Ùˆ Ø¬Ø°Ø§Ø¨ Ú©Ù†Ø¯.</p>
      <p>Ø¨Ø§ Ù‡Ø± Ø¨Ø§Ø± Ø´Ú©Ø³ØªÙ† ÛŒÚ© Ø¢Ø¬Ø±ØŒ ÙÙ‚Ø· Ø¯Ø± Ø¨Ø§Ø²ÛŒ Ù¾ÛŒØ´ Ù†Ù…ÛŒâ€ŒØ±ÙˆÛŒØ› Ø¨Ù„Ú©Ù‡ ÛŒÚ© Ù‚Ø¯Ù… Ú©ÙˆÚ†Ú© Ø¨Ø±Ø§ÛŒ Ø±Ø´Ø¯ Ø´Ø®ØµÛŒ Ùˆ Ø¢Ø±Ø§Ù…Ø´ Ø¯Ø±ÙˆÙ†ÛŒâ€ŒØ§Øª Ø¨Ø±Ù…ÛŒâ€ŒØ¯Ø§Ø±ÛŒ.</p>
      <p style="font-size:12px;opacity:.9;margin-top:8px;">
        Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· <b>Ø·Ø§ÙˆÛŒØªØ§</b> Â·
        <a href="https://eitaa.com/tavita" target="_blank" rel="noopener" style="color:#38bdf8;text-decoration:none;">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„ Ø·Ø§ÙˆÛŒØªØ§</a>
      </p>
      <button class="closeBtn" id="closeAbout">Ø¨Ø³ØªÙ†</button>
    </div>
  </div>

  <!-- Ù¾Ø±ÙˆÙØ§ÛŒÙ„ -->
  <div id="profileOverlay" class="overlay">
    <div class="box">
      <h3>Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø¨Ø¯Ø´Ú©Ù† ğŸ‘¤</h3>
      <div id="profileStats">
        <p>Ù†Ø§Ù…: <b><span id="profName">Ú©Ø§Ø±Ø¨Ø± Ø·Ø§ÙˆÛŒØªØ§</span></b></p>
        <p>Ù…Ø±Ø­Ù„Ù‡ ÙØ¹Ù„ÛŒ: <b><span id="profLevel">1</span></b></p>
        <p>Ø§Ù…ØªÛŒØ§Ø² ÙØ¹Ù„ÛŒ: <b><span id="profScore">0</span></b></p>
        <p>ØªØ¹Ø¯Ø§Ø¯ Ø¬ÙˆÙ†â€ŒÙ‡Ø§: <b><span id="profLives">3</span></b></p>
        <p>ØªÙ…Ø±ÛŒÙ† Ø§Ù…Ø±ÙˆØ²: <b><span id="profDaily">0/6</span></b></p>
        <p>Ø³Ø§Ø¨Ù‚Ù‡ Ø´Ú©Ø³ØªÙ† Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø¯: <b><span id="profBroken">0</span> Ø¢Ø¬Ø±</b></p>
      </div>
      <button class="closeBtn" id="closeProfile">Ø¨Ø³ØªÙ†</button>
    </div>
  </div>

  <!-- Ø´Ø§Ù¾ -->
  <div id="shopOverlay" class="overlay">
    <div class="box" id="shopBox">
      <h3>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø±ÙØªØ§Ø±Ù‡Ø§ÛŒ Ø®ÙˆØ¨ ğŸŒ±</h3>
      <div id="shopMessage"></div>
      <div class="shopItem" data-item-row="pad">
        <span>Ù¾Ø¯ Ø¢Ú¯Ø§Ù‡â€ŒØªØ± (Ù¾Ù‡Ù†â€ŒØªØ± Ø´Ø¯Ù† Ù¾Ø¯)</span>
        <span>Ù‡Ø²ÛŒÙ†Ù‡: 150 Ø§Ù…ØªÛŒØ§Ø²</span>
        <button data-item="pad">Ø®Ø±ÛŒØ¯</button>
      </div>
      <div class="shopItem" data-item-row="strength">
        <span>ØªÙ„Ø§Ø´ Ø¨ÛŒØ´ØªØ± (ØªÙˆÙ¾ Ù‚ÙˆÛŒâ€ŒØªØ±)</span>
        <span>Ù‡Ø²ÛŒÙ†Ù‡: 220 Ø§Ù…ØªÛŒØ§Ø²</span>
        <button data-item="strength">Ø®Ø±ÛŒØ¯</button>
      </div>
      <div class="shopItem" data-item-row="slow">
        <span>Ø¢Ø±Ø§Ù…Ø´ Ø¯Ø±ÙˆÙ† (Ú©Ù†Ø¯ Ø´Ø¯Ù† ØªÙˆÙ¾ Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ù„ Ø¨Ù‡ØªØ±)</span>
        <span>Ù‡Ø²ÛŒÙ†Ù‡: 180 Ø§Ù…ØªÛŒØ§Ø²</span>
        <button data-item="slow">Ø®Ø±ÛŒØ¯</button>
      </div>
      <button class="closeBtn" id="closeShop">Ø¨Ø³ØªÙ†</button>
    </div>
  </div>

  <!-- Ú¯ÛŒÙ… Ø§ÙˆØ± -->
  <div id="gameOverOverlay" class="overlay">
    <div class="box" id="gameOverBox">
      <h3>Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ ğŸ®</h3>
      <p id="goScore">Ø§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§: 0</p>
      <p id="goLevel" style="font-size:12px;opacity:.85;"></p>
      <p style="font-size:12px;opacity:.9;">
        Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒ Ùˆ Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø¯ Ø¨ÛŒØ´ØªØ±ÛŒ Ø±Ùˆ Ø¨Ø´Ú©Ù†ÛŒ ğŸ˜
      </p>
      <button id="retryBtn" class="closeBtn">Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†</button>
    </div>
  </div>

  <!-- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ ØªÙ…Ø±ÛŒÙ† Ø±ÙˆØ²Ø§Ù†Ù‡ -->
  <div id="dailyOverlay" class="overlay">
    <div class="box">
      <h3>ØªÙ…Ø±ÛŒÙ† Ø±ÙˆØ²Ø§Ù†Ù‡ ğŸŒ±</h3>
      <p id="dailyText"></p>
      <button class="closeBtn" id="closeDaily">Ø¨Ø§Ø´Ù‡</button>
    </div>
  </div>

  <!-- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø¢Ø±Ø§Ù…Ø´ -->
  <div id="calmOverlay" class="overlay">
    <div class="box">
      <h3>Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ø¢Ø±Ø§Ù…Ø´ ğŸ’™</h3>
      <p>Ú†Ù†Ø¯ Ù†ÙØ³ Ø¹Ù…ÛŒÙ‚ Ø¨Ú©Ø´ØŒ Ø´Ø§Ù†Ù‡â€ŒÙ‡Ø§Øª Ø±Ùˆ Ø±Ù‡Ø§ Ú©Ù† Ùˆ ÙÙ‚Ø· Ú†Ù†Ø¯ Ø«Ø§Ù†ÛŒÙ‡ Ø­Ø±Ú©Øª ØªÙˆÙ¾ Ø±Ùˆ Ù†Ú¯Ø§Ù‡ Ú©Ù†. Ù‡Ù…ÛŒÙ† Ú†Ù†Ø¯ Ù„Ø­Ø¸Ù‡ Ù‡Ù… ÛŒÚ© ØªÙ…Ø±ÛŒÙ† Ø°Ù‡Ù†â€ŒØ¢Ú¯Ø§Ù‡ÛŒ Ùˆ Ø¢Ø±Ø§Ù…Ø´Ù‡ ğŸŒ¿</p>
      <button class="closeBtn" id="closeCalm">Ø¨Ø³ØªÙ†</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const scoreEl = document.getElementById("scoreEl");
    const levelEl = document.getElementById("levelEl");
    const livesEl = document.getElementById("livesEl");
    const soundBtn = document.getElementById("soundBtn");
    const pauseBtn = document.getElementById("pauseBtn");
    const helpBtn = document.getElementById("helpBtn");
    const aboutBtn = document.getElementById("aboutBtn");
    const profileBtn = document.getElementById("profileBtn");
    const themeBtn = document.getElementById("themeBtn");
    const calmBtn = document.getElementById("calmBtn");
    const hintEl = document.getElementById("hint");
    const helpOverlay = document.getElementById("helpOverlay");
    const closeHelpBtn = document.getElementById("closeHelp");
    const aboutOverlay = document.getElementById("aboutOverlay");
    const closeAboutBtn = document.getElementById("closeAbout");
    const profileOverlay = document.getElementById("profileOverlay");
    const closeProfileBtn = document.getElementById("closeProfile");
    const shopOverlay = document.getElementById("shopOverlay");
    const shopBtn = document.getElementById("shopBtn");
    const closeShopBtn = document.getElementById("closeShop");
    const shopMessage = document.getElementById("shopMessage");
    const gameOverOverlay = document.getElementById("gameOverOverlay");
    const goScore = document.getElementById("goScore");
    const goLevel = document.getElementById("goLevel");
    const retryBtn = document.getElementById("retryBtn");
    const progressInner = document.getElementById("progressBarInner");

    const dailyInnerEl = document.getElementById("dailyInner");
    const dailyDots = document.querySelectorAll(".dailyDot");
    const dailyOverlay = document.getElementById("dailyOverlay");
    const dailyText = document.getElementById("dailyText");
    const closeDailyBtn = document.getElementById("closeDaily");

    const calmOverlay = document.getElementById("calmOverlay");
    const closeCalmBtn = document.getElementById("closeCalm");

    const profNameEl = document.getElementById("profName");
    const profLevelEl = document.getElementById("profLevel");
    const profScoreEl = document.getElementById("profScore");
    const profLivesEl = document.getElementById("profLives");
    const profDailyEl = document.getElementById("profDaily");
    const profBrokenEl = document.getElementById("profBroken");

    const nameOverlay = document.getElementById("nameOverlay");
    const nameInput = document.getElementById("nameInput");
    const saveNameBtn = document.getElementById("saveNameBtn");

    let playerName = "Ú©Ø§Ø±Ø¨Ø± Ø·Ø§ÙˆÛŒØªØ§";

    let w, h;

    // ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ
    let paddle,ball,bricks,powerUps,score,level,lives,
        running,paused,strongBallTicks=0,
        slowBallTicks=0,burstTicks=0,totalBricksLevel=0,
        totalBrokenHabits=0;

    // âœ… Ù†Ø³Ø®Ù‡ Ø§ØµÙ„Ø§Ø­â€ŒØ´Ø¯Ù‡â€ŒÛŒ resizeCanvas
    function resizeCanvas() {
  const container = document.getElementById("game-container");
  const rect = container.getBoundingClientRect();

  const maxWidth = 480;          // Ø­Ø¯Ø§Ú©Ø«Ø± Ø¹Ø±Ø¶ Ù…Ø«Ù„ Ù‚Ø¨Ù„
  const targetRatio = 1.4;       // Ù†Ø³Ø¨Øª Ø§Ø±ØªÙØ§Ø¹ Ø¨Ù‡ Ø¹Ø±Ø¶ (Ú©Ø§Ø±Øª Ø®ÙˆØ´Ú¯Ù„ØŒ Ù†Ù‡ Ø®ÛŒÙ„ÛŒ Ø¯Ø±Ø§Ø²)

  // Ø¹Ø±Ø¶ Ø¨Ø§Ø²ÛŒ
  w = Math.min(rect.width, maxWidth);

  // Ø§Ø±ØªÙØ§Ø¹ Ø§ÛŒØ¯Ù‡â€ŒØ¢Ù„ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ø³Ø¨Øª
  let idealHeight = w * targetRatio;   // Ù…Ø«Ù„Ø§ Ø§Ú¯Ø± w=360 â†’ hâ‰ˆ504

  // Ø§Ø±ØªÙØ§Ø¹ Ù†Ù‡Ø§ÛŒÛŒ: Ø§Ø² Ø§Ø±ØªÙØ§Ø¹ Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø¨ÛŒØ´ØªØ± Ù†Ø´Ù‡
  h = Math.min(idealHeight, rect.height);

  canvas.width = w;
  canvas.height = h;

  // Ø§Ú¯Ø± Ø¨Ø§Ø²ÛŒ Ù‚Ø¨Ù„Ø§Ù‹ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ØŒ Ù¾Ø¯ Ùˆ ØªÙˆÙ¾ Ø±Ùˆ Ø¨Ù‡ Ø¬Ø§ÛŒ Ø¯Ø±Ø³ØªØ´ÙˆÙ† Ø¨Ø¨Ø±ÛŒÙ…
  if (paddle && ball) {
    paddle.y = h - 40;                 // Ù¾Ø¯ Ù‡Ù…ÛŒØ´Ù‡ 40px Ø§Ø² Ù¾Ø§ÛŒÛŒÙ†
    if (paddle.x + paddle.w > w) {
      paddle.x = w - paddle.w;
    }
    if (ball.stuckToPaddle) {
      ball.x = paddle.x + paddle.w / 2;
      ball.y = paddle.y - ball.r - 1;
    }
  }
}
    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);
    window.addEventListener("orientationchange", resizeCanvas);

    // ØªÙ… Ø±ÙˆØ²/Ø´Ø¨
    let currentTheme = "dark";
    function applyTheme(mode){
      if(mode==="light"){
        document.body.classList.add("light-mode");
        currentTheme="light";
        themeBtn.textContent = "â˜€ï¸";
      }else{
        document.body.classList.remove("light-mode");
        currentTheme="dark";
        themeBtn.textContent = "ğŸŒ™";
      }
      try{
        localStorage.setItem("tavitaTheme",currentTheme);
      }catch(e){}
    }
    (function initTheme(){
      try{
        const t = localStorage.getItem("tavitaTheme");
        if(t==="light") applyTheme("light");
        else applyTheme("dark");
      }catch(e){
        applyTheme("dark");
      }
    })();

    themeBtn.onclick = ()=>{
      applyTheme(currentTheme==="dark" ? "light" : "dark");
    };

    // Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±
    function loadPlayerName(){
      try{
        const n = localStorage.getItem("tavitaName");
        if(n && n.trim()){
          playerName = n.trim();
        }
      }catch(e){}
      if(profNameEl) profNameEl.textContent = playerName;
    }
    function savePlayerName(){
      try{
        localStorage.setItem("tavitaName",playerName);
      }catch(e){}
      if(profNameEl) profNameEl.textContent = playerName;
    }
    loadPlayerName();

    (function initNameOverlay(){
      try{
        const raw = localStorage.getItem("tavitaName");
        if(!raw || !raw.trim()){
          setTimeout(()=>{
            nameOverlay.style.display = "flex";
            nameInput.focus();
          },400);
        }
      }catch(e){
        setTimeout(()=>{
          nameOverlay.style.display = "flex";
          nameInput.focus();
        },400);
      }
    })();

    saveNameBtn.onclick = ()=>{
      const val = nameInput.value.trim();
      if(val){
        playerName = val;
        savePlayerName();
      }
      nameOverlay.style.display = "none";
    };
    nameOverlay.addEventListener("click",e=>{
      if(e.target === nameOverlay){
        nameOverlay.style.display = "none";
      }
    });

    // ØªÙ…Ø±ÛŒÙ† Ø±ÙˆØ²Ø§Ù†Ù‡
    function todayKey(){
      const d = new Date();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const day = String(d.getDate()).padStart(2,"0");
      return d.getFullYear()+"-"+m+"-"+day;
    }
    let dailyCount = 0;
    function updateDailyUI(){
      dailyDots.forEach((dot,i)=>{
        if(i<dailyCount) dot.classList.add("filled");
        else dot.classList.remove("filled");
      });
      if(profDailyEl){
        profDailyEl.textContent = dailyCount + "/6";
      }
    }
    function loadDaily(){
      try{
        const raw = localStorage.getItem("tavitaDaily");
        if(raw){
          const obj = JSON.parse(raw);
          if(obj.date === todayKey()){
            dailyCount = obj.count || 0;
          }else{
            dailyCount = 0;
          }
        }else{
          dailyCount = 0;
        }
      }catch(e){
        dailyCount = 0;
      }
      updateDailyUI();
    }
    function saveDaily(){
      try{
        localStorage.setItem("tavitaDaily",JSON.stringify({
          date: todayKey(),
          count: dailyCount
        }));
      }catch(e){}
    }
    loadDaily();

    if(dailyInnerEl){
      dailyInnerEl.addEventListener("click",()=>{
        const msg = dailyCount === 0
          ? "Ø§Ù…Ø±ÙˆØ² Ù‡Ù†ÙˆØ² ØªÙ…Ø±ÛŒÙ†ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡. Ù‡Ø± Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ú©Ø§Ù…Ù„ Ø±Ø¯ Ú©Ù†ÛŒØŒ ÛŒÚ©ÛŒ Ø§Ø² Ø¯Ø§ÛŒØ±Ù‡â€ŒÙ‡Ø§ÛŒ ØªÙ…Ø±ÛŒÙ† Ø±ÙˆØ²Ø§Ù†Ù‡ Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ ğŸŒ±"
          : `Ø§Ù…Ø±ÙˆØ² ØªØ§ Ø§Ù„Ø§Ù† ${dailyCount} Ø§Ø² Û¶ ØªÙ…Ø±ÛŒÙ† Ø±ÙˆØ²Ø§Ù†Ù‡â€ŒØ§Øª Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ø§Ø¯ÛŒ. Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¯Ù‡ ØªØ§ Ù‡Ù…Ù‡â€ŒÛŒ Ø¯Ø§ÛŒØ±Ù‡â€ŒÙ‡Ø§ Ø±ÙˆØ´Ù† Ø´ÙˆÙ†Ø¯ âœ¨`;
        dailyText.textContent = msg;
        dailyOverlay.style.display = "flex";
      });
    }
    closeDailyBtn.onclick = ()=>{ dailyOverlay.style.display="none"; };
    dailyOverlay.addEventListener("click",e=>{
      if(e.target===dailyOverlay) dailyOverlay.style.display="none";
    });

    // Ø¯Ú©Ù…Ù‡ Ù„Ø­Ø¸Ù‡ Ø¢Ø±Ø§Ù…Ø´
    calmBtn.onclick = ()=>{
      calmOverlay.style.display = "flex";
    };
    closeCalmBtn.onclick = ()=>{ calmOverlay.style.display="none"; };
    calmOverlay.addEventListener("click",e=>{
      if(e.target===calmOverlay) calmOverlay.style.display="none";
    });

    // ØµØ¯Ø§
    let audioCtx;
    let isMuted = false;
    function beep(freq=600,dur=0.06){
      if(isMuted) return;
      try{
        if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.frequency.value = freq;
        osc.type="square";
        gain.gain.value = 0.08;
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime+dur);
      }catch(e){}
    }
    soundBtn.onclick=()=>{
      isMuted = !isMuted;
      soundBtn.textContent = isMuted ? "ğŸ”‡" : "ğŸ”Š";
    };

    // Ø±Ø§Ù‡Ù†Ù…Ø§
    helpBtn.onclick = ()=>{ helpOverlay.style.display="flex"; };
    closeHelpBtn.onclick = ()=>{ helpOverlay.style.display="none"; };
    helpOverlay.addEventListener("click",e=>{
      if(e.target===helpOverlay) helpOverlay.style.display="none";
    });

    // Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§
    aboutBtn.onclick = ()=>{ aboutOverlay.style.display="flex"; };
    closeAboutBtn.onclick = ()=>{ aboutOverlay.style.display="none"; };
    aboutOverlay.addEventListener("click",e=>{
      if(e.target===aboutOverlay) aboutOverlay.style.display="none";
    });

    // Ù¾Ø±ÙˆÙØ§ÛŒÙ„
    profileBtn.onclick = ()=>{
      profNameEl.textContent = playerName;
      profLevelEl.textContent = level;
      profScoreEl.textContent = score;
      profLivesEl.textContent = lives;
      profDailyEl.textContent = dailyCount + "/6";
      profBrokenEl.textContent = totalBrokenHabits;
      profileOverlay.style.display = "flex";
    };
    closeProfileBtn.onclick = ()=>{ profileOverlay.style.display="none"; };
    profileOverlay.addEventListener("click",e=>{
      if(e.target===profileOverlay) profileOverlay.style.display="none";
    });

    // Ù…ØªÙ†â€ŒÙ‡Ø§ Ùˆ Ø±Ù†Ú¯â€ŒÙ‡Ø§
    const badWords = [
      "ØªÙ†Ø¨Ù„ÛŒ","Ø¯Ø±ÙˆØº","Ø­Ø³Ø§Ø¯Øª","ØºÛŒØ¨Øª","Ù†Ø§Ø§Ù…ÛŒØ¯ÛŒ",
      "ØªØ±Ø³","Ø®Ø´Ù…","Ø¨Ø¯Ù‚ÙˆÙ„ÛŒ","Ø®ÙˆØ¯Ú©Ù…\u200cØ¨ÛŒÙ†ÛŒ","Ø¨ÛŒ\u200cØ§Ø­ØªØ±Ø§Ù…ÛŒ"
    ];
    const positiveByLabel = {
      "ØªÙ†Ø¨Ù„ÛŒ":"Ø¢ÙØ±ÛŒÙ†! Ù‡Ù…ÛŒÙ† Ú©Ù‡ Ø´Ø±ÙˆØ¹ Ú©Ø±Ø¯ÛŒ ÛŒØ¹Ù†ÛŒ Ø§Ø² ØªÙ†Ø¨Ù„ÛŒ Ø¬Ù„Ùˆ Ø²Ø¯ÛŒ ğŸ’ª",
      "Ø¯Ø±ÙˆØº":"Ø±Ø§Ø³ØªÚ¯ÙˆÛŒÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø³Ø¨Ú©â€ŒØªØ±Ù‡Ø› ÛŒÚ©ÛŒ Ø§Ø² Ø¯Ø±ÙˆØºâ€ŒÙ‡Ø§ Ø±Ùˆ ØªØ±Ú©ÙˆÙ†Ø¯ÛŒ âœ¨",
      "Ø­Ø³Ø§Ø¯Øª":"ØªÙ…Ø±Ú©Ø² Ø±ÙˆÛŒ Ø±Ø´Ø¯ Ø®ÙˆØ¯ØªØŒ Ø­Ø³Ø§Ø¯Øª Ø±Ùˆ Ú©Ù… Ù…ÛŒâ€ŒÚ©Ù†Ù‡ ğŸŒ±",
      "ØºÛŒØ¨Øª":"Ú©Ù…ØªØ± ØºÛŒØ¨ØªØŒ ÛŒØ¹Ù†ÛŒ Ø¢Ø±Ø§Ù…Ø´ Ø¨ÛŒØ´ØªØ± Ø¨Ø±Ø§ÛŒ Ø¯Ù„ Ø®ÙˆØ¯Øª ğŸ’œ",
      "Ù†Ø§Ø§Ù…ÛŒØ¯ÛŒ":"Ù‡Ù…ÛŒÙ† Ø­Ø§Ù„Ø§ ÛŒÚ© Ù‚Ø¯Ù… Ø¨Ø±Ø¯Ø§Ø´ØªÛŒØ› Ù†Ø§Ø§Ù…ÛŒØ¯ÛŒ Ú©ÙˆÚ†ÛŒÚ©â€ŒØªØ± Ø´Ø¯ âœ¨",
      "ØªØ±Ø³":"Ø´Ø¬Ø§Ø¹Øª ÛŒØ¹Ù†ÛŒ Ø¨Ø§ ÙˆØ¬ÙˆØ¯ ØªØ±Ø³ Ø­Ø±Ú©Øª Ú©Ù†ÛŒØ› ØªÙˆ Ù‡Ù…ÛŒÙ† Ú©Ø§Ø±Ùˆ Ú©Ø±Ø¯ÛŒ ğŸ’›",
      "Ø®Ø´Ù…":"Ù†ÙØ³ Ø¹Ù…ÛŒÙ‚â€¦ ØªÙˆ Ø§Ø² Ø®Ø´Ù…Øª Ù‚ÙˆÛŒâ€ŒØªØ±ÛŒ ğŸŒ¿",
      "Ø¨Ø¯Ù‚ÙˆÙ„ÛŒ":"Ù‡Ù…ÛŒÙ† Ú©Ù‡ Ø­ÙˆØ§Ø³Øª Ø¨Ù‡ Ù‚ÙˆÙ„â€ŒÙ‡Ø§Øª Ù‡Ø³ØªØŒ ÛŒØ¹Ù†ÛŒ Ø¯Ø§Ø±ÛŒ Ø±Ø´Ø¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒ ğŸ¤",
      "Ø®ÙˆØ¯Ú©Ù…\u200cØ¨ÛŒÙ†ÛŒ":"ØªÙˆ Ø®ÛŒÙ„ÛŒ Ø¨ÛŒØ´ØªØ± Ø§Ø² Ú†ÛŒØ²ÛŒ Ú©Ù‡ ÙÚ©Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒ ØªÙˆØ§Ù†Ø§ÛŒÛŒ Ø¯Ø§Ø±ÛŒ ğŸŒŸ",
      "Ø¨ÛŒ\u200cØ§Ø­ØªØ±Ø§Ù…ÛŒ":"Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø­ØªØ±Ø§Ù…ØŒ ÛŒØ¹Ù†ÛŒ Ø§Ø­ØªØ±Ø§Ù… Ø¨Ù‡ Ø®ÙˆØ¯Øª Ùˆ Ø¯ÛŒÚ¯Ø±Ø§Ù† ğŸ’š"
    };
    const habitColors = {
      "ØªÙ†Ø¨Ù„ÛŒ":"#f97316",
      "Ø¯Ø±ÙˆØº":"#ef4444",
      "Ø­Ø³Ø§Ø¯Øª":"#22c55e",
      "ØºÛŒØ¨Øª":"#6366f1",
      "Ù†Ø§Ø§Ù…ÛŒØ¯ÛŒ":"#0ea5e9",
      "ØªØ±Ø³":"#facc15",
      "Ø®Ø´Ù…":"#dc2626",
      "Ø¨Ø¯Ù‚ÙˆÙ„ÛŒ":"#a855f7",
      "Ø®ÙˆØ¯Ú©Ù…\u200cØ¨ÛŒÙ†ÛŒ":"#ec4899",
      "Ø¨ÛŒ\u200cØ§Ø­ØªØ±Ø§Ù…ÛŒ":"#14b8a6"
    };
    const goodMessages = [
      "ØªÙˆ Ù…Ù‡Ø±Ø¨ÙˆÙ†ÛŒ Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯ÛŒ â¤ï¸",
      "ØªÙˆ Ø¯Ø± Ø­Ø§Ù„ Ø±Ø´Ø¯ Ùˆ Ù¾ÛŒØ´Ø±ÙØªÛŒ ğŸ’ª",
      "ØªÙˆ ØµØ¨ÙˆØ± Ùˆ Ù‚ÙˆÛŒ Ù‡Ø³ØªÛŒ ğŸ’™",
      "ØªÙˆ Ø±Ø§Ø³ØªÚ¯Ùˆ Ùˆ Ø´Ø¬Ø§Ø¹ÛŒ ğŸ’›",
      "ØªÙˆ Ø§Ù†Ø³Ø§Ù† Ù…Ø«Ø¨ØªÛŒ Ù‡Ø³ØªÛŒ âœ¨",
      "ØªÙˆ Ø§Ø² Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø¯Øª Ù‚ÙˆÛŒâ€ŒØªØ±ÛŒ ğŸ˜",
      "ØªÙˆ Ø§Ù„Ù‡Ø§Ù…â€ŒØ¨Ø®Ø´ Ø§Ø·Ø±Ø§ÙÛŒØ§Ù†ÛŒ ğŸ’œ"
    ];
    function randomItem(arr){return arr[Math.floor(Math.random()*arr.length)];}

    function lightenColor(hex, amount){
      try{
        let c = hex.replace("#","");
        if(c.length===3) c = c.split("").map(ch=>ch+ch).join("");
        let r = parseInt(c.substring(0,2),16);
        let g = parseInt(c.substring(2,4),16);
        let b = parseInt(c.substring(4,6),16);
        r = Math.min(255, Math.floor(r + (255-r)*amount));
        g = Math.min(255, Math.floor(g + (255-g)*amount));
        b = Math.min(255, Math.floor(b + (255-b)*amount));
        return "#" + [r,g,b].map(v=>v.toString(16).padStart(2,"0")).join("");
      }catch(e){
        return hex;
      }
    }

    function drawRoundedRect(ctx,x,y,w,h,r){
      const rr = Math.min(r, w/2, h/2);
      ctx.beginPath();
      ctx.moveTo(x+rr,y);
      ctx.lineTo(x+w-rr,y);
      ctx.quadraticCurveTo(x+w,y,x+w,y+rr);
      ctx.lineTo(x+w,y+h-rr);
      ctx.quadraticCurveTo(x+w,y+h,x+w-rr,y+h);
      ctx.lineTo(x+rr,y+h);
      ctx.quadraticCurveTo(x,y+h,x,y+h-rr);
      ctx.lineTo(x,y+rr);
      ctx.quadraticCurveTo(x,y,x+rr,y);
      ctx.closePath();
    }

    

    function updateHUD(){
      scoreEl.textContent=score;
      levelEl.textContent=level;
      livesEl.textContent=lives;
    }
    function flashHint(text,ms=2600){
      hintEl.textContent=text;
      if(flashHint._t) clearTimeout(flashHint._t);
      flashHint._t = setTimeout(()=>{
        hintEl.textContent="Ø¨Ø§ Ø§Ù†Ú¯Ø´Øª Ù¾ÙØ¯ Ø±Ø§ Ø­Ø±Ú©Øª Ø¨Ø¯Ù‡ Ùˆ Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø¯ Ø±Ø§ Ø¨Ø´Ú©Ù† ğŸ’«";
      },ms);
    }
    function updateProgressBar(ratio){
      if(!progressInner) return;
      const v = Math.max(0,Math.min(1,ratio||0));
      progressInner.style.width = (v*100).toFixed(1)+"%";
    }

    function patternForLevel(lvl){
      if(lvl<=10) return "SQUARE";
      if(lvl<=20) return "CIRCLE";
      if(lvl<=30) return "HEART";
      return "SQUARE";
    }

    function brickSizeByLevel(lvl){
      let size;
      if(lvl<=10){
        size = 3 - (2/9)*(lvl-1);
      }else if(lvl<=20){
        size = 2 - (1/9)*(lvl-11);
      }else if(lvl<=30){
        size = 1.5 - (0.5/9)*(lvl-21);
      }else{
        size = 1;
      }
      return size;
    }

    function buildPatternBricks(name,lvl){
      let grid=[];
      const scale = brickSizeByLevel(lvl);
      if(name==="SQUARE"){
        grid=[
          "11111111",
          "11111111",
          "11111111",
          "11111111"
        ];
      }else if(name==="CIRCLE"){
        grid=[
          "000111000",
          "001111100",
          "011111110",
          "011111110",
          "001111100",
          "000111000"
        ];
      }else if(name==="HEART"){
        grid=[
          "00111100111100",
          "01111111111110",
          "11111111111111",
          "11111111111111",
          "01111111111110",
          "00111111111100",
          "00011111111000",
          "00001111110000",
          "00000111100000",
          "00000011000000"
        ];
      }
      const rows=grid.length;
      const cols=grid[0].length;
      const padding=4;
      const brickW=(w-(cols+1)*padding)/cols;
      const baseH=14;
      const brickH=baseH*scale;
      const marginTop=40;
      const out=[];
      for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
          if(grid[r][c]==="1"){
            const x=padding+c*(brickW+padding);
            const y=marginTop+r*(brickH+padding);
            const hits=1+Math.floor(level/2);
            const label=randomItem(badWords);
            const typeRand=Math.random();
            let type="normal";
            if(typeRand<0.1) type="ice";
            else if(typeRand<0.18) type="strong";
            else if(typeRand<0.24) type="bomb";
            else if(typeRand<0.28) type="golden";
            out.push({x,y,w:brickW,h:brickH,hits,label,type});
          }
        }
      }
      return out;
    }

    function buildLevel(){
      const name=patternForLevel(level);
      if(name){
        bricks=buildPatternBricks(name,level);
        flashHint("Ù…Ø±Ø­Ù„Ù‡ "+level+" - Ø§Ù„Ú¯ÙˆÛŒ "+name+" âœ¨");
      }else{
        bricks=[];
      }
      totalBricksLevel=bricks.length;
      updateProgressBar(0);
    }

    function resetGame(){
      const minPadW=40,maxPadW=100;
      const padW=minPadW,padH=12;
      paddle={
        x:(w-padW)/2,
        y:h-40,
        w:padW,
        h:padH,
        minW:minPadW,
        maxW:maxPadW,
        speed:9
      };
      ball={
        x:w/2,
        y:h-60,
        r:6,
        vx:3.5,
        vy:-4.5,
        stuckToPaddle:true
      };
      powerUps=[];
      score=0;
      level=1;
      lives=3;
      running=true;
      paused=false;
      strongBallTicks=0;
      slowBallTicks=0;
      burstTicks=0;
      totalBricksLevel=0;
      totalBrokenHabits=0;
      buildLevel();
      updateHUD();
      updateProgressBar(0);
      flashHint("Ø¨Ø§ Ù¾ÙØ¯ ØªÙˆÙ¾ Ø±Ùˆ Ø¨Ù‡ Ø³Ù…Øª Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø¯ Ø¨ÙØ±Ø³Øª Ùˆ Ø¨Ø´Ú©Ù†Ø´ÙˆÙ† ğŸ’¥",3000);
      pauseBtn.textContent="â¸";
    }
    resetGame();

    function restartAfterGameOver(){
      const targetLevel = level>=3 ? Math.max(1, level-1) : 1;

      const padW = paddle.minW;
      paddle.x = (w-padW)/2;
      paddle.y = h-40;
      paddle.w = padW;
      paddle.h = 12;
      paddle.speed = 9;

      ball.x = w/2;
      ball.y = h-60;
      ball.r = 6;
      ball.vx = 3.5*(Math.random()<0.5?-1:1);
      ball.vy = -4.5;
      ball.stuckToPaddle = true;

      powerUps = [];
      strongBallTicks = 0;
      slowBallTicks = 0;
      burstTicks = 0;
      lives = 3;
      level = targetLevel;

      buildLevel();
      updateHUD();
      updateProgressBar(0);

      flashHint(
        targetLevel===1
          ? "Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ø² Ø§ÙˆÙ„ Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…Ø› Ø§ÛŒÙ†â€ŒØ¨Ø§Ø± Ù‚ÙˆÛŒâ€ŒØªØ± ğŸ’ª"
          : `Ø¨Ø±Ú¯Ø´ØªÛŒ Ø¨Ù‡ Ù…Ø±Ø­Ù„Ù‡ ${targetLevel}Ø› Ø§ÛŒÙ†â€ŒØ¨Ø§Ø± Ø­ÙˆØ§Ø³Øª Ø±Ùˆ Ø¨ÛŒØ´ØªØ± Ø¬Ù…Ø¹ Ú©Ù† ğŸ˜‰`,
        2600
      );

      paused = false;
      running = true;
      pauseBtn.textContent = "â¸";
    }

    function movePaddleTo(clientX){
      const rect=canvas.getBoundingClientRect();
      const x=(clientX-rect.left)*(w/rect.width);
      paddle.x=x-paddle.w/2;
      if(paddle.x<0) paddle.x=0;
      if(paddle.x+paddle.w>w) paddle.x=w-paddle.w;
      if(ball.stuckToPaddle){
        ball.x=paddle.x+paddle.w/2;
        ball.y=paddle.y-ball.r-1;
      }
    }
    canvas.addEventListener("mousemove",e=>{
      if(!running||paused) return;
      movePaddleTo(e.clientX);
    });
    canvas.addEventListener("mousedown",e=>{
      if(!running||paused) return;
      if(ball.stuckToPaddle){
        ball.stuckToPaddle=false;
        beep(700);
      }
    });
    canvas.addEventListener("touchstart",e=>{
      if(!running||paused) return;
      const t=e.touches[0];
      movePaddleTo(t.clientX);
      if(ball.stuckToPaddle){
        ball.stuckToPaddle=false;
        beep(700);
      }
      e.preventDefault();
    },{passive:false});
    canvas.addEventListener("touchmove",e=>{
      if(!running||paused) return;
      const t=e.touches[0];
      movePaddleTo(t.clientX);
      e.preventDefault();
    },{passive:false});

    pauseBtn.onclick=()=>{
      if(!running) return;
      paused=!paused;
      pauseBtn.textContent=paused?"â–¶ï¸":"â¸";
      flashHint(paused?"Ø¨Ø§Ø²ÛŒ Ù…ØªÙˆÙ‚Ù Ø´Ø¯ â¸":"Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø§Ø²ÛŒ â–¶ï¸",1500);
    };

    shopBtn.onclick=()=>{
      if(!running) return;
      shopOverlay.style.display="flex";
    };
    closeShopBtn.onclick=()=>{shopOverlay.style.display="none";};
    shopOverlay.addEventListener("click",e=>{
      if(e.target===shopOverlay) shopOverlay.style.display="none";
    });

    function showShopMsg(text){
      shopMessage.textContent=text;
      shopMessage.classList.remove("shopMessageVisible");
      void shopMessage.offsetWidth;
      shopMessage.classList.add("shopMessageVisible");
    }
    document.querySelectorAll(".shopItem button").forEach(btn=>{
      btn.addEventListener("click",()=>{
        const item=btn.getAttribute("data-item");
        let cost=0;
        if(item==="pad") cost=150;
        else if(item==="strength") cost=220;
        else if(item==="slow") cost=180;
        if(score<cost){
          showShopMsg("Ø§Ù…ØªÛŒØ§Ø² Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒ ğŸ˜…");
          beep(200,0.1);
          return;
        }
        score-=cost;
        if(item==="pad"){
          paddle.w=Math.min(paddle.w+12,paddle.maxW);
          flashHint("Ù¾Ø¯Øª Ø¢Ú¯Ø§Ù‡â€ŒØªØ± Ùˆ Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ø´Ø¯ ğŸŒ±",2000);
        }else if(item==="strength"){
          strongBallTicks+=1000;
          flashHint("ØªÙˆÙ¾ Ù‚ÙˆÛŒâ€ŒØªØ± Ø´Ø¯ ğŸ’ª",2000);
        }else if(item==="slow"){
          slowBallTicks+=900;
          flashHint("ØªÙˆÙ¾ Ú©Ù…ÛŒ Ø¢Ù‡Ø³ØªÙ‡â€ŒØªØ± Ø´Ø¯Ø› Ú©Ù†ØªØ±Ù„ Ø¨Ù‡ØªØ± ğŸ’™",2200);
        }
        const row=document.querySelector(`.shopItem[data-item-row="${item}"]`);
        if(row){
          row.classList.add("bought");
          setTimeout(()=>row.classList.remove("bought"),260);
        }
        showShopMsg("Ø±ÙØªØ§Ø± Ø®ÙˆØ¨ Ø®Ø±ÛŒØ¯ÛŒØ› Ø¢ÙØ±ÛŒÙ† Ø¨Ù‡ ØªÙˆ â¤ï¸");
        updateHUD();
      });
    });

    function showLifeGainEffect(text){
      const el=document.createElement("div");
      el.className="lifeGain";
      el.textContent=text;
      document.body.appendChild(el);
      setTimeout(()=>el.remove(),1000);
    }

    function showGameOver(){
      running=false;
      gameOverOverlay.style.display="flex";
      goScore.textContent="Ø§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§: "+score;
      goLevel.textContent="Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø±Ø³ÛŒØ¯ÛŒ: "+level;
    }
    retryBtn.onclick=()=>{
      gameOverOverlay.style.display="none";
      restartAfterGameOver();
    };
    gameOverOverlay.addEventListener("click",e=>{
      if(e.target===gameOverOverlay){
        gameOverOverlay.style.display="none";
        restartAfterGameOver();
      }
    });

    function spawnPowerUp(x,y){
      let type;
      const roll = Math.random();
      if(roll < 0.8){
        const posTypes = ["pad","strength","slow","burst"];
        type = posTypes[Math.floor(Math.random()*posTypes.length)];
      }else{
        type = "bad";
      }
      const labelGood=randomItem(goodMessages);
      powerUps.push({x,y,r:9,vy:1.3,type,labelGood});
    }
    function applyPowerUp(pu){
      if(pu.type==="pad"){
        paddle.w=Math.min(paddle.w+10,paddle.maxW);
        flashHint("Ù¾Ø¯Øª Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ø´Ø¯ â¤ï¸",2000);
      }else if(pu.type==="strength"){
        strongBallTicks+=900;
        flashHint("ØªÙˆÙ¾ Ù‚ÙˆÛŒâ€ŒØªØ± Ø´Ø¯ ğŸ’ª",2000);
      }else if(pu.type==="slow"){
        slowBallTicks+=800;
        flashHint("ØªÙˆÙ¾ Ú©Ù…ÛŒ Ø¢Ù‡Ø³ØªÙ‡â€ŒØªØ± Ø´Ø¯ ğŸ’™",2000);
      }else if(pu.type==="burst"){
        burstTicks+=260;
        flashHint("Ú†Ù†Ø¯ØªÙˆÙ¾ÛŒ ÙØ¹Ø§Ù„ Ø´Ø¯ ğŸ˜ğŸ”¥",2500);
      }else if(pu.type==="bad"){
        paddle.w = Math.max(paddle.w-12,paddle.minW);
        flashHint("ÛŒÚ© ØªÙˆÙ¾ Ø³ÛŒØ§Ù‡ Ú¯Ø±ÙØªÛŒØ› Ù¾Ø¯Øª Ú©ÙˆÚ†Ú©ØªØ± Ø´Ø¯ØŒ Ø­ÙˆØ§Ø³Øª Ø±Ùˆ Ø¬Ù…Ø¹ Ú©Ù† ğŸ™ƒ",2600);
      }
      beep(900,0.1);
    }

    function update(){
      if(!running||paused) return;
      if(strongBallTicks>0) strongBallTicks--;
      if(slowBallTicks>0) slowBallTicks--;
      if(burstTicks>0) burstTicks--;
      if(ball.stuckToPaddle){
        ball.x=paddle.x+paddle.w/2;
        ball.y=paddle.y-ball.r-1;
        return;
      }
      let speedFactor=1;
      if(slowBallTicks>0) speedFactor*=0.7;
      ball.x+=ball.vx*speedFactor;
      ball.y+=ball.vy*speedFactor;

      if(ball.x-ball.r<0){
        ball.x=ball.r;
        ball.vx*=-1;
      }
      if(ball.x+ball.r>w){
        ball.x=w-ball.r;
        ball.vx*=-1;
      }
      if(ball.y-ball.r<0){
        ball.y=ball.r;
        ball.vy*=-1;
      }

      if(
        ball.y+ball.r>=paddle.y &&
        ball.y+ball.r<=paddle.y+paddle.h &&
        ball.x>=paddle.x && ball.x<=paddle.x+paddle.w &&
        ball.vy>0
      ){
        const hitPos=(ball.x-(paddle.x+paddle.w/2))/(paddle.w/2);
        ball.vx=hitPos*5;
        ball.vy=-Math.abs(ball.vy);
        beep(600);
      }

      if(ball.y-ball.r>h){
        lives--;
        updateHUD();
        if(lives<=0){
          beep(200,0.2);
          showGameOver();
          return;
        }else{
          beep(250,0.16);
          ball.x=paddle.x+paddle.w/2;
          ball.y=paddle.y-ball.r-1;
          ball.vx=3.5*(Math.random()<0.5?-1:1);
          ball.vy=-4.5;
          ball.stuckToPaddle=true;
          burstTicks=0;
        }
      }

      for(const pu of powerUps){
        pu.y+=pu.vy;
      }
      for(let i=powerUps.length-1;i>=0;i--){
        const pu=powerUps[i];
        if(
          pu.y+pu.r>=paddle.y &&
          pu.y-pu.r<=paddle.y+paddle.h &&
          pu.x>=paddle.x && pu.x<=paddle.x+paddle.w
        ){
          applyPowerUp(pu);
          powerUps.splice(i,1);
        }else if(pu.y-pu.r>h){
          powerUps.splice(i,1);
        }
      }

      for(let i=bricks.length-1;i>=0;i--){
        const b=bricks[i];
        if(
          ball.x+ball.r>b.x &&
          ball.x-ball.r<b.x+b.w &&
          ball.y+ball.r>b.y &&
          ball.y-ball.r<b.y+b.h
        ){
          const overlapL=ball.x+ball.r-b.x;
          const overlapR=b.x+b.w-(ball.x-ball.r);
          const overlapT=ball.y+ball.r-b.y;
          const overlapB=b.y+b.h-(ball.y-ball.r);
          const minO=Math.min(overlapL,overlapR,overlapT,overlapB);
          if(minO===overlapL||minO===overlapR) ball.vx*=-1;
          else ball.vy*=-1;

          let damage=1;
          if(strongBallTicks>0) damage=2;
          if(b.type==="ice"){
            if(!b._iceHit){ b._iceHit=true; }
            else b.hits-=damage;
          }else if(b.type==="strong"){
            b.hits-=damage*0.8;
          }else if(b.type==="golden"){
            b.hits-=damage;
          }else{
            b.hits-=damage;
          }

          if(b.hits<=0){
            totalBrokenHabits++;
            let baseScore=10;
            if(b.type==="strong") baseScore=14;
            if(b.type==="golden") baseScore=20;
            score+=baseScore;
            if(Math.random()<0.25) spawnPowerUp(b.x+b.w/2,b.y+b.h/2);
            if(b.type==="bomb"){
              for(const nb of bricks){
                if(nb===b) continue;
                const dx=(nb.x+nb.w/2)-(b.x+b.w/2);
                const dy=(nb.y+nb.h/2)-(b.y+b.h/2);
                const dist=Math.sqrt(dx*dx+dy*dy);
                if(dist<60) nb.hits-=damage;
              }
            }
            const posMsg=positiveByLabel[b.label]||`ÛŒÚ©ÛŒ Ø§Ø² "${b.label}"â€ŒÙ‡Ø§ Ø±Ùˆ Ø´Ú©Ø³ØªÛŒØ› Ø¢ÙØ±ÛŒÙ† ğŸ’š`;
            flashHint(posMsg,2600);
            bricks.splice(i,1);
            if(totalBricksLevel>0){
              const cleared=totalBricksLevel-bricks.length;
              updateProgressBar(cleared/totalBricksLevel);
            }
          }else{
            score+=3;
          }
          beep(800,0.05);
          updateHUD();
          break;
        }
      }

      if(bricks.length===0){
        level++;
        lives+=2;
        updateHUD();
        showLifeGainEffect("+2 â¤ï¸");

        if(dailyCount<6){
          dailyCount++;
          saveDaily();
          updateDailyUI();
          const msg = `ÛŒÚ© Ù…Ø±Ø­Ù„Ù‡â€ŒÛŒ Ø¯ÛŒÚ¯Ø± Ø±Ø§ Ú©Ø§Ù…Ù„ Ú©Ø±Ø¯ÛŒØ› ØªÙ…Ø±ÛŒÙ† Ø§Ù…Ø±ÙˆØ² Ø´Ø¯ ${dailyCount} Ø§Ø² Û¶ ğŸŒ±`;
          dailyText.textContent = msg;
          dailyOverlay.style.display = "flex";
        }

        ball.stuckToPaddle=true;
        ball.x=paddle.x+paddle.w/2;
        ball.y=paddle.y-ball.r-1;
        ball.vx*=1.08;
        ball.vy*=1.08;

        buildLevel();
        updateHUD();
        updateProgressBar(0);
        flashHint("Ù…Ø±Ø­Ù„Ù‡ "+level+" Ø´Ø±ÙˆØ¹ Ø´Ø¯Ø› Û² ØªØ§ Ø¬ÙˆÙ† ØªØ§Ø²Ù‡ Ú¯Ø±ÙØªÛŒ â¤ï¸",2500);
        beep(1000,0.15);
      }
    }

    function draw(){
      ctx.clearRect(0,0,w,h);

      if(currentTheme === "light"){
        const gLight = ctx.createLinearGradient(0,0,0,h);
        gLight.addColorStop(0,"#ffffff");
        gLight.addColorStop(1,"#e5e7eb");
        ctx.fillStyle = gLight;
        ctx.fillRect(0,0,w,h);
      }else{
        const g=ctx.createLinearGradient(0,0,0,h);
        g.addColorStop(0,"#151b5c");
        g.addColorStop(1,"#09071e");
        ctx.fillStyle=g;
        ctx.fillRect(0,0,w,h);
      }

      // Ø¢Ø¬Ø±Ù‡Ø§
      for(const b of bricks){
        let baseColor = habitColors[b.label] || "#ffb347";
        let color = baseColor;
        if(b.type==="golden") color = "#ffd700";

        const grad = ctx.createLinearGradient(b.x,b.y,b.x,b.y+b.h);
        grad.addColorStop(0, lightenColor(color,0.22));
        grad.addColorStop(1, color);

        ctx.save();
        drawRoundedRect(ctx,b.x,b.y,b.w,b.h,6);
        ctx.fillStyle = grad;
        ctx.fill();

        ctx.lineWidth = (b.type==="bomb") ? 2 : 1;
        ctx.strokeStyle =
          b.type==="ice" ? "#60a5fa" :
          b.type==="strong" ? "#f97373" :
          b.type==="bomb" ? "#a855f7" :
          b.type==="golden" ? "#facc15" :
          "#00000040";
        ctx.stroke();

        ctx.beginPath();
        drawRoundedRect(ctx,b.x+2,b.y+2,b.w-4,(b.h-4)/2,4);
        ctx.fillStyle = "rgba(255,255,255,0.25)";
        ctx.fill();

        ctx.fillStyle="#111";
        ctx.font="9px Vazirmatn";
        ctx.textAlign="center";
        ctx.textBaseline="middle";
        ctx.direction="rtl";
        ctx.fillText(b.label,b.x+b.w/2,b.y+b.h/2);
        ctx.restore();
      }

      // Ù¾Ø§ÙˆØ±Ø¢Ù¾â€ŒÙ‡Ø§
      for(const pu of powerUps){
        let c="#1abc9c";
        if(pu.type==="strength") c="#ff9f43";
        else if(pu.type==="slow") c="#9b59b6";
        else if(pu.type==="burst") c="#e91e63";
        else if(pu.type==="bad") c="#111827";
        ctx.beginPath();
        ctx.arc(pu.x,pu.y,pu.r,0,Math.PI*2);
        const g2=ctx.createRadialGradient(pu.x,pu.y,2,pu.x,pu.y,pu.r+3);
        g2.addColorStop(0,"#ffffff");
        g2.addColorStop(1,c);
        ctx.fillStyle=g2;
        ctx.fill();
        ctx.strokeStyle = pu.type==="bad" ? "#ef4444" : "#ffffffaa";
        ctx.lineWidth=1;
        ctx.stroke();
      }

      // Ù¾ÙØ¯
      let paddleColor = currentTheme === "light" ? "#1f2937" : "#3ac7ff";
      ctx.fillStyle=paddleColor;
      ctx.fillRect(paddle.x,paddle.y,paddle.w,paddle.h);
      ctx.fillStyle=currentTheme==="light" ? "#00000020" : "#ffffff55";
      ctx.fillRect(paddle.x,paddle.y,paddle.w,3);

      if(burstTicks>0){
        const t=Date.now()/300;
        const count=4,offset=8;
        for(let i=0;i<count;i++){
          const ang=(Math.PI*2/count)*i+t;
          const bx=ball.x+Math.cos(ang)*offset;
          const by=ball.y+Math.sin(ang)*offset;
          ctx.beginPath();
          ctx.arc(bx,by,ball.r-2,0,Math.PI*2);
          ctx.fillStyle="rgba(255,255,255,0.35)";
          ctx.fill();
        }
      }

      // ØªÙˆÙ¾
      ctx.beginPath();
      ctx.arc(ball.x,ball.y,ball.r,0,Math.PI*2);
      let ballColor;
      if(currentTheme === "light"){
        ballColor = strongBallTicks>0 ? "#b91c1c" : "#dc2626";
      }else{
        ballColor = strongBallTicks>0 ? "#fffb8a" : "#ffffff";
      }
      ctx.fillStyle=ballColor;
      ctx.fill();
      ctx.strokeStyle=currentTheme==="light" ? "#00000040" : "#ffffff55";
      ctx.lineWidth=1;
      ctx.stroke();
    }

    function loop(){
      update();
      draw();
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);
  </script>

  <script src="/api/eitaa.js"></script>
</body>
</html>
